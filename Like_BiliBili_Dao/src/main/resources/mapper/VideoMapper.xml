<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.grazy.mapper.VideoMapper">


    <insert id="insertVideo" parameterType="com.grazy.domain.Video" keyProperty="id" useGeneratedKeys="true">
        insert into t_video(
                    id,
                    userId,
                    url,
                    thumbnail,
                    title,
                    type,
                    duration,
                    area,
                    description,
                    createTime
                )values (
                    #{id},
                         #{userId},
                         #{url},
                         #{thumbnail},
                         #{title},
                         #{type},
                         #{duration},
                         #{area},
                         #{description},
                         #{createTime}
                )
    </insert>


    <insert id="batchAddVideoTags" parameterType="java.util.List">
        insert into t_video_tag(
                        videoId,
                        tagId,
                        createTime
                    )values
        <foreach collection="videoTagList" item="videoTag" separator=",">
            (
                #{videoTag.videoId},
                #{videoTag.tagId},
                #{videoTag.createTime}
            )
        </foreach>
    </insert>


    <select id="selectCountByAre" resultType="java.lang.Integer">
        select count(1) from t_video
        <where>
            <if test="area != null and area != '' " >
                area = #{area}
            </if>
        </where>
        order by createTime desc
    </select>


    <select id="selectVideosByArea" resultType="com.grazy.domain.Video">
        select * from t_video
        <where>
            <if test="area != null and area != '' " >
                area = #{area}
            </if>
        </where>
        order by createTime desc
        limit #{startNumber},#{size}
    </select>


    <select id="selectVideoTagListByVideoId" resultType="com.grazy.domain.VideoTag">
        select * from t_video_tag where videoId = #{videoId}
    </select>


    <select id="selectVideoByVideoId" resultType="com.grazy.domain.Video">
        select * from t_video where id = #{videoId}
    </select>


    <select id="selectVideoLike" resultType="com.grazy.domain.VideoLike">
        select * from t_video_like where userId = #{currentUserId} and videoId = #{videoId}
    </select>


    <insert id="insertVideoLike">
        insert into t_video_like(
                        userId,
                        videoId,
                        createTime
                    )values (
                        #{currentUserId},
                        #{videoId},
                        #{createTime}
                    )
    </insert>


    <delete id="deleteVideoLike">
        delete from t_video_like where userId = #{currentUserId} and videoId = #{videoId}
    </delete>


    <select id="selectVideoLikeCountByVideoId" resultType="java.lang.Integer">
        select count(1) from t_video_like where videoId = #{videoId}
    </select>


    <select id="selectCollectionGroupIdByType" resultType="java.lang.Long">
        select id from t_collection_group where type = #{groupType}
    </select>


    <select id="selectVideoCollectionByUserIdAndVideoId" resultType="com.grazy.domain.VideoCollection">
        select * from t_video_collection where userId = #{userId} and videoId = #{videoId}
    </select>


    <insert id="insertVideoCollection">
        insert into t_video_collection(
                            userId,
                            videoId,
                            groupId,
                            createTime
                    ) values (
                        #{userId},
                        #{videoId},
                        #{groupId},
                        #{createTime}
                    )
    </insert>


    <delete id="deleteVideoCollection">
        delete from t_video_collection where where userId = #{userId} and videoId = #{videoId}
    </delete>


    <select id="selectVideoCollectionCountByVideoId" resultType="java.lang.Integer">
        select count(1) from t_video_collection where videoId = #{videoId}
    </select>


    <select id="selectVideoCoinsByUserIdAndVideoId" resultType="com.grazy.domain.VideoCoin">
        select * from t_video_coin where userId = #{userId} and videoId = #{videoId}
    </select>


    <insert id="insertVideoCoins">
        insert into t_video_coin(
                userId,
                amount,
                createTime
        )values (
                 #{userId},
                 #{amount},
                 #{createTime}
        )
    </insert>


    <select id="selectVideoCoinsAmount" resultType="java.lang.Integer">
        select amount from t_video_coin where userId = #{userId} and videoId = #{videoId}
    </select>


    <update id="updateVideoCoins">
        update t_video_coin set amount = #{amount}, updateTime = #{updateTime} where userId = #{userId}
    </update>


    <select id="selectVideoCoinsNumber" resultType="java.lang.Integer">
        select
            sum(amount)
        from
            t_video_coin
        where
            videoId = #{videoId}
    </select>


    <insert id="insertVideoComment">
        insert into t_video_comment(
                videoId,
                userId,
                comment,
                replyUserId,
                rootId,
                createTime
        )values (
                #{videoId},
                 #{userId},
                 #{comment},
                 #{replyUserId},
                 #{rootId},
                 #{createTime}
        )
    </insert>


    <select id="selectVideoCommentCountByVideoId" resultType="java.lang.Integer">

    </select>
</mapper>